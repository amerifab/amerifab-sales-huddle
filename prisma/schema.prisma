// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  password  String
  name      String
  role      String    @default("REP") // REP, MANAGER, ADMIN
  createdAt DateTime  @default(now())
  insights  Insight[]
}

model Customer {
  id               String    @id @default(cuid())
  name             String
  location         String?
  contact          String?
  rep              String?
  type             String    @default("Key Account") // Key Account, Growth, Prospect
  notes            String?
  story            String?   // AI-generated "Whole Story" narrative
  storyGeneratedAt DateTime? // When the story was last generated
  insights         Insight[]
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

model Insight {
  id         String   @id @default(cuid())
  type       String   // context, need, action, dossier
  content    String
  rep        String?
  date       DateTime @default(now())
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  createdBy  String?
  user       User?    @relation(fields: [createdBy], references: [id])
}
